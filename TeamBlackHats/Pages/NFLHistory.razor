@page "/History"
@using System.Text.Json

<PageTitle>NFL Team Data</PageTitle>

<h1>NFL History</h1> 

<br />
<a href="#" class="btn btn-sm btn-danger">HomePage</a>
<br />

@if (History == null)
{
    <p>Loading...History</p>
}
else
{
    <div style="max-height: 600px; overflow-y: auto;">

        <table class="table table-striped table-bordered align-top bg-light">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Team ID</th>
                    <th>Team Name</th>
                    <th>Conference</th>
                    <th>Division</th>
                    <th>First Year</th>
                    <th>Total Seasons</th>
                    <th>Total Win</th>
                    <th>Total Lost</th>
                    <th>Total Tie</th>
                    <th>Championship Won</th>
                    <th>SuperBowl Won</th>
                    <th>Stadium Name</th>
                    <th>Stadium Location</th>
                    <th>Year Open</th>
                    <th>Team Color</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var hx in History)
                {
                    <tr>
                        <td>@hx.ID</td>
                        <td>@hx.TeamID</td>
                        <td>@hx.TeamName</td>
                        <td>@hx.Conference</td>
                        <td>@hx.Division</td>
                        <td>@hx.FirstYear</td>
                        <td>@hx.TotalSeasons</td>
                        <td>@hx.TotalWin</td>
                        <td>@hx.TotalLost</td>
                        <td>@hx.TotalTie</td>
                        <td>@hx.Championship</td>
                        <td>@hx.SuperBowl</td>
                        <td>@hx.StadiumName</td>
                        <td>@hx.Location</td>
                        <td>@hx.YearOpen</td>
                        <td>@hx.TeamColor</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <br />
    <form>
        <label>
            Search by Team ID:
        </label>
        <input type="text" @bind="historyData" />
        <button type="button" class="btn btn-warning" @onclick=GetHistory>SUBMIT></button>
    </form>
}

@code
{
    private class NFLhisory
    {
        public int ID { get; set; }
        public string? TeamID { get; set; }
        public string? TeamName { get; set; }
        public string? Conference { get; set; }
        public string? Division { get; set; }
        public int FirstYear { get; set; }
        public int TotalSeasons { get; set; }
        public int TotalWin { get; set; }
        public int TotalLost { get; set; }
        public int TotalTie { get; set; }
        public int Championship { get; set; }
        public string? SuperBowl { get; set; }
        public string? StadiumName { get; set; }
        public string? Location { get; set; }
        public int YearOpen { get; set; }
        public string? TeamColor { get; set; }
    }
    private List<NFLhisory> History;
    private string historyData;

    string API_URI = "https://localhost:7275/api/BlackHatsApp/";

    protected override async Task OnInitializedAsync()
    {
        HttpClient httpClient = new HttpClient();
        HttpResponseMessage response = await httpClient.GetAsync(API_URI + "GetNFLTeamHx");
        httpClient.Dispose();
        using var responseStream = await response.Content.ReadAsStreamAsync();
        History = await JsonSerializer.DeserializeAsync<List<NFLhisory>>(responseStream);
    }

    public async Task GetHistory()
    {
        HttpClient httpClient1 = new HttpClient();
        HttpClient httpClient = httpClient1;
        HttpResponseMessage response = await httpClient.GetAsync(API_URI + "GetNFLTeamHx");
        httpClient.Dispose();
        using var responseStream = await response.Content.ReadAsStreamAsync();
        var searchteam = await JsonSerializer.DeserializeAsync<List<NFLhisory>>(responseStream);
        History = searchteam.Where(Hx => Hx.TeamID == historyData).ToList();
    }
}

